<%- include('./partials/header'); -%>
    <title>Nạp xu</title>
    <a href="/mainScreen" class="fs-3">    
        <i class='bx bx-arrow-back'>Trở về</i>
    </a>
    <div class="container text-center">
        
        <h2>Nạp xu vào game</h2>
        <% if(typeof userInfo != 'undefined') {%>
        <p>id User:</p>
        <p class="fw-bold">
            <%= userInfo._id.toString() %>
        </p>
        
        <p>Số xu hiện có :</p>
        <p class="fw-bold">
            <%= userInfo.tongxu %> xu
        </p>

        <h2>Bảng mệnh giá nạp xu</h2>
        <p>1 xu = 2.000 đ</p>


        <input type="hidden" id="nickname" value="<%= userInfo.nickname%>">
        <input type="hidden" id="tongxu" value="<%= userInfo.tongxu%>">
        <% } %> 
        <table width="100%">
            <thead>
                <th>STT</th>
                <th>Số tiền nạp</th>
                <th>Số xu quy đổi</th>
                <th>Nạp tiền</th>
            </thead>
            <tbody>
                <tr>
                    <td>1</td>
                    <td>
                        10.000 đ - <img id="totienvnd" src="/img/10000-dong.jpg" alt="">
                    </td>
                    <td>5 xu</td>
                    <td>
                        <button type="button" class="btn btn-danger" data-money="5">Nạp</button>
                    </td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>
                        20.000 đ - <img id="totienvnd" src="/img/20_ngan.png" alt="">
                    </td>
                    <td>10 xu</td>
                    <td>
                        <button type="button" class="btn btn-danger" data-money="10">Nạp</button>
                    </td>
                </tr>
                <tr>
                    <td>3</td>
                    <td>
                        50.000 đ - <img id="totienvnd" src="/img/50ngan.jpg" alt="">
                    </td>
                    <td>25 xu</td>
                    <td>
                        <button type="button" class="btn btn-danger" data-money="25">Nạp</button>
                    </td>
                </tr>
                <tr>
                    <td>4</td>
                    <td>
                        100.000 đ - <img id="totienvnd" src="/img/100_ngan.png" alt="">
                    </td>
                    <td>50 xu</td>
                    <td>
                        <button type="button" class="btn btn-danger" data-money="50">Nạp</button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>


    <!-- Button trigger modal -->
<button type="button" id="modal_btn" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal" style="display:none">
  </button>
  
  <!-- Modal -->
  <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Chờ xác nhận từ Admin</h5>
      
        </div>
        <div class="modal-body">
            Vui lòng chờ trong giây lát để Admin xử lý...

            <img style="    width: 100%;
            height: 100%;
            object-fit: contain;
            object-position: center;" src="https://media.tenor.com/pLmeY8SLsigAAAAM/happy-administrative-professionals-day-administrative-professionals.gif" alt="">
        </div>
      </div>
    </div>
  </div>

 

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.2/jquery.js" integrity="sha512-NMtENEqUQ8zHZWjwLg6/1FmcTWwRS2T5f487CCbQB3pQwouZfbrQfylryimT3XvQnpE7ctEKoZgQOAkWkCW/vg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/notify/0.4.2/notify.js" integrity="sha512-uE2UhqPZkcKyOjeXjPCmYsW9Sudy5Vbv0XwAVnKBamQeasAVAmH6HR9j5Qpy6Itk1cxk+ypFRPeAZwNnEwNuzQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
 
    <script>
        var socket = io();

        //Khi phát hiện có người nhấn vào phòng mua thẻ - chỉ xử lí 1 sự kiện/lần
        socket.on("connect", () => {
            socket.emit('userbuycard', socket.id);
        })


        let btn_buyCard = document.querySelectorAll('.btn-danger')
        let modal = document.querySelector('#modal_btn')
        var money = ''
        var cancel = document.querySelector('cancel_buy_card')

        btn_buyCard.forEach((item, index)=>{
            item.addEventListener('click',(e)=>{
                money = e.target.getAttribute("data-money") 

                let nickname = document.querySelector('#nickname').value;
                let tongxu = document.querySelector('#tongxu').value;
                
                let data_user_send = {
                    money: money,
                    nickname: nickname,
                    tongxu: tongxu,
                    socket_user: socket.id
                }

                socket.emit('userOnline', data_user_send) 
                modal.click()
            })
        })

    

        socket.on('accept_buy_card',(data)=>{
            $.notify("Nạp tiền thành công", "success");
            let modal = document.querySelector('.modal')
            let modal_b = document.querySelectorAll('.modal-backdrop')
            modal.style.display = 'none'
            modal_b.forEach((item, index)=>{
                item.style.display = 'none'
            })
            setTimeout(()=>{
                window.location.href = 'mainScreen'
            },1200)
        })

        
        socket.on('deny_buy_card',(data)=>{
            $.notify("Nạp tiền thất bại !", "error");
            let modal = document.querySelector('.modal')
            let modal_b = document.querySelectorAll('.modal-backdrop')
            modal.style.display = 'none'
            modal_b.forEach((item, index)=>{
                item.style.display = 'none'
            })
            setTimeout(()=>{
                window.location.href = 'mainScreen'
            },1200)
        })
        
        socket.on('outbuycard',()=>{
            socket.emit('outbuycard')
        })

        socket.on('waitingUser',(data)=>{
            alert('Vui lòng quay lại sau...')
            window.location.href = 'mainScreen'
        })
    </script>


</body>
</html>